---
title: "Daghestanian loans database"
author: Ilya Chechuro, Michael Daniel, Samira Verhees
date: "`r Sys.Date()`"
output:
  rmdformats::readthedown:
    highlight: kate
    css: style.css
---


```{r knitr_init, echo=FALSE, cache=FALSE}
library(knitr)
library(rmdformats)

## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```

*Authors: Ilya Chechuro, Michael Daniel, and Samira Verhees.*

This database contains wordlists collected as part of the [Daghestanian loans](https://ilcl.hse.ru/en/projects) project by the [Linguistic Convergence Laboratory](https://ilcl.hse.ru/en/) at NRU HSE. The aim of the 160-item shortlist, which is based on the [World Loanword Database questionnaire](https://wold.clld.org/), is to measure lexical contact on a micro-level. In other words, to quantify lexical convergence among the speech communities of minority languages on a village-level, and to detect fine-grained areal patterns beyond general observations on the spheres of influence of certain languages.


```{r, echo=FALSE, message=FALSE, warning=FALSE}

# loading packages
#Sys.setlocale("LC_TIME","ru_RU.UTF-8")
library(tidyverse)
library(DT)
library(lingtypology)
#library(fansi)


# loading data - mind the date in the csv filename!

words <- read_tsv("words_standardized_01042019.tsv")

meta <- read_tsv("meta_01042019.tsv")


# select relevant parameters from metadata file

meta <- meta %>%  select(`List ID`, Type, Birthyear, Gender, Code, Language, Family, Group, Glottocode, Village, District, Lat, Lon)

# merge table with target words and the corresponding metadata

words_meta <- merge(words, meta, by = 'List ID')

words_meta$Set <- paste(words_meta$`Concept nr.`, "-", words_meta$Stem)

# select some variables for the datatable (= database interface)

database <- words_meta %>% select(`Concept nr.`, Concept, Word, `Standardized Transcription`, Set, Village, Language, Family, Group, District, `List ID`, Birthyear, Gender)



#dummy_dataset <- read.csv("words01032019_dummy.tsv", sep = "\t", header = TRUE)



```

Contents:

```{r}

content <- words_meta %>%
  group_by(`List ID`, Language, Word) %>%
  summarise(Words = n())


languages <- length(unique(content$Language))
target_words <- sum(content$Words)

all <- rbind(target_words, languages)

all

```
##How to cite this project
If you use data from the database in your research, please cite as follows:

Chechuro I., Daniel M., Dobrushina N., and Verhees S. 2019. Daghestanian loans database. Linguistic Convergence Laboratory, HSE. (Available online at https://lingconlab.github.io/Dagloan_database/DL_database.html, [![DOI](https://zenodo.org/badge/164257298.svg)](https://zenodo.org/badge/latestdoi/164257298), accessed on `r format(Sys.time(), '%B %d, %Y')`.)

## The database

For now, the table shows source **Concepts** and target **Words**. Each target word is grouped in a similarity **Set** - a set of words that have the same meaning and look similar. In the future, data will be added on borrowing sources. Metadata includes the name of the **Village** where the word was recorded, the administrative **District** it is part of, the **Language** spoken there, and the **List ID**: these ID's correspond to a particular speaker or in some cases a written source like a dictionary. Data is accessible at: [Github/LingConLab/DagloanDatabase](https://github.com/LingConLab/DagloanDatabase).
<br>
The dataset in the dummy format is available [here](https://github.com/LingConLab/Dagloan_database/blob/master/Convert/words_28032019_dummy.tsv). 
<br>

```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Create a searchable datatable with filters on top
database$`Concept nr.` <- as.factor(database$`Concept nr.`)
database$`List ID` <- as.factor(database$`List ID`)
database$Gender <- as.factor(database$Gender)
database$Birthyear <- as.integer(database$Birthyear)
database$Family <- as.factor(database$Family)
database$Group <- as.factor(database$Group)
database$Language <- as.factor(database$Language)
database$Village <- as.factor(database$Village)
database$Concept <- as.factor(database$Concept)
database$Set <- as.factor(database$Set)
database$District <- as.factor(database$District)


database %>% datatable(class = 'cell-border stripe', 
          filter = 'top', 
          #options = list(pageLength = 100),
          extensions = 'Buttons', 
          options = list(
            autoWidth = TRUE,
            columnDefs = list(list(width = '50px', targets = c(1, 5))),
            pageLength = 10,
            dom = 'lBfrtip',
            buttons = c('copy', 'csv')))
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Show the data with the dummy variables 

#datatable(dummy_dataset, class = 'cell-border stripe', filter = 'top',
#          extensions = 'Buttons', fillContainer = TRUE, options = list(
#            pageLength = 100,
#            dom = 'Bfrtip',
#            buttons = c('copy', 'csv')
#  ))
```
---

Version: `r Sys.Date()`. For questions or comments contact jh.verhees@gmail.com.

---

## Map of the surveyed villages

Hover over and / or click on a dot on the map to know more. The color of the dots corresponds to the *number* of lists collected in a village. Orange = dictionary data.

```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Remove certain NA's for now

meta <- meta[complete.cases(meta$Glottocode),]


# Separate dictionaries from speakers

dict <- meta %>%
  filter(meta$Type == 'Dictionary')

speakers <- meta %>%
  filter(meta$Type == 'Speaker')


# Create a dataframe that shows the number of lists per village

lists <- speakers %>%
  group_by(Village, Language, Glottocode, Lat, Lon) %>%
  summarise(Lists = n())


# Convert the column with counts to a factor

lists$Lists <- as.factor(lists$Lists)

```


```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width = 9, fig.height= 7}


# Draw a map that shows each village and the number of lists collected


map.feature(lang.gltc(lists$Glottocode),
            feature = lists$Lists,
            color = "magma",
            latitude = lists$Lat,
            longitude = lists$Lon,
            zoom.control = TRUE,
            legend = TRUE,
            title = "Lists",
            width = 7,
            label = lists$Language,
            popup = paste(aff.lang(lang.gltc(lists$Glottocode)), # Popup with genetic info on language + name of village
                          "<br>",
                          "<br>",
                          "<b> Village: </b>",
                          lists$Village),
            zoom.level = 7.5) %>% # Put another map on top of it, showing dictionary data
              map.feature(lang.gltc(dict$Glottocode),
              latitude = dict$Lat,
              longitude = dict$Lon,
              feature = dict$Language,
              label = dict$Language,
              popup = paste(aff.lang(lang.gltc(dict$Glottocode)),
                            "<br>",
                            "<br>",
                            "<b>Source:</b>",
                            "[Insert reference to literature here]"),
              legend = FALSE,
              color = c("orange"),
              tile = c("Esri.WorldGrayCanvas"),
              pipe.data = .)
```

## Sample lexical map

The map below shows the distribution of different stems for the concept 'pepper'.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width = 9, fig.height= 7}

pepper <- words_meta[(words_meta$Concept == 'the pepper'),]

pepper <- pepper[complete.cases(pepper$Word),]
pepper <- pepper[complete.cases(pepper$Glottocode),]

map.feature(lang.gltc(pepper$Glottocode),
            latitude = pepper$Lat,
            longitude = pepper$Lon,
            features = pepper$Set,
            zoom.control = T,
            zoom.level = 7.5,
            label = pepper$Language,
            popup = pepper$Word)


```

##Sources of lexical influence

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width = 9, fig.height= 7}
words_src <- read.csv("words_01042019.tsv", header = TRUE, sep = "\t", na.strings = "NA", row.names = NULL)
#write_tsv(as.data.frame(levels(as.factor(words$Concept))), "wordlist.tsv", na = "NA")

library(tidyverse)
library(ggplot2)

d <- read.csv("convert/words_01042019_dummy.tsv", header = TRUE, sep = "\t", na.strings = "NA", row.names = NULL)
#head(d)
row.names(d) <- d[,1]
#d_long <- gather(d, Lexeme, Present, the_ant_1:the_year_12, factor_key=TRUE)
d$District <- as.character(d$District)
Districts <- d[,c(1:4)]
#d$District <- factor(d$District, levels = c("Tabasaran", "Khiv", "Rutul", "Tsakhur", "Tabasaran_Azeri", "Qax_Azeri"))
#head(as.data.frame(t(d)))
d <- d[,-c(1:4)]
d <- as.data.frame(t(d))

turkic=as.matrix(d)
turkic[is.na(turkic)] <- 0
turkic=as.data.frame(turkic)

d$Turk_total <- turkic$D_Azerbaijani+turkic$D_Kumyk+turkic$Darvag1+turkic$Darvag2+turkic$Darvag3+turkic$Darvag4+turkic$Darvag5+turkic$Darvag6+turkic$Ilisu1+turkic$Yersi1+turkic$Yersi2+turkic$Yersi3+turkic$Yersi4+turkic$Qax1+turkic$Qax2+turkic$Qax3+turkic$Qax7+turkic$Qax8+turkic$Qax9

d$AvarAndic_total <- turkic$D_Avar+turkic$D_Gagatli+turkic$Karata1+turkic$Karata2+turkic$Karata3+turkic$Karata4+turkic$Rikvani1+turkic$`Tad-Magitl1`+turkic$`Tad-Magitl2`+turkic$Tukita1+turkic$Zilo1+turkic$Zilo2+turkic$Tlibisho1+turkic$Tlibisho2+turkic$Tlibisho3+turkic$Tlibisho4+turkic$D_Bagvalal+turkic$Kusur1+turkic$Bezhta1+turkic$D_Bezhta1+turkic$D_Botlikh+turkic$D_Hinuq+turkic$D_Karata+turkic$D_Tsez+turkic$Kidero1+turkic$Kidero2+turkic$Kidero3+turkic$D_Bezhta2

#d <- as.data.frame(t(d))
#head(d)

#Preparing datasets for plotting
all_turkic <-  as.data.frame(t(d[which(d$Turk_total>0 & d$D_Russian != 1 & d$D_Arabic != 1 & d$D_Persian != 1),]))
all_turkic$Speaker <- rownames(all_turkic)
all_turkic <- left_join(Districts, all_turkic, by= c("Speaker"))
#head(all_turkic)

#all_turkic$District <- as.factor(all_turkic$District)
all_turkic <- all_turkic[all_turkic$District %in% c("Akhvakh", "Botlikh", "Rutul", "Tsunta"),]
all_turkic$District <- factor(all_turkic$District, levels(all_turkic$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#all_turkic$District <- as.factor(all_turkic$District)
all_turkic <- gather(all_turkic,Lexeme,Present, the_ant_5:the_year_2,factor_key=TRUE)
#head(all_turkic)

avar_cognates <- read_tsv("Avar_Cognate_Test(Samira+Kusur).tsv")
avar_cognates <- avar_cognates[which(avar_cognates$Cognate_Samira == "y"),]
avar <-  as.data.frame(t(d[which(d$D_Avar>0 & d$D_Russian != 1 & d$D_Arabic != 1 & d$D_Persian != 1 & d$Turk_total == 0),]))
avar$Speaker <- rownames(avar)
avar <- left_join(Districts, avar, by= c("Speaker"))
#avar$District <- as.factor(avar$District)
avar <- avar[avar$District %in% c("Akhvakh", "Botlikh", "Rutul", "Tsunta"),]
avar$District <- factor(avar$District, levels(avar$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#avar$District <- as.factor(avar$District)
avar <- gather(avar,Lexeme,Present, the_ant_20:the_year_11,factor_key=TRUE)
#head(avar)
avar <- avar[-which(avar$Lexeme %in% avar_cognates$Lexeme.x),]

#avar_cognate_test <- as.data.frame(t(d[which(d$AvarAndic_total>1 & d$D_Russian != 1 & d$D_Arabic != 1 & d$D_Persian != 1 & d$Turk_total == 0),]))
#avar_cognate_test$Speaker <- rownames(avar_cognate_test)
#avar_cognate_test <- left_join(Districts, avar_cognate_test, by= c("Speaker"))
#avar_cognate_test <- gather(avar_cognate_test,Lexeme,Present, the_ant_20:the_year_12,factor_key=TRUE)
#avar_cognate_test <- avar_cognate_test[avar_cognate_test$District %in% c("Akhvakh", "Botlikh", "Tsunta") | avar_cognate_test$Speaker %in% c("D_Avar"),]
#avar_cognate_test <- avar_cognate_test[which(avar_cognate_test$Present == 1),]
#words_meta$Lexeme <- paste(gsub(" ", "_", words_meta$Concept, fixed = TRUE), words_meta$Stem, sep = "_")
#words_meta$SpkrLexeme <- paste(words_meta$Code, words_meta$Lexeme, sep = "_")
#avar_cognate_test$SpkrLexeme <- paste(avar_cognate_test$Speaker, avar_cognate_test$Lexeme, sep = "_")
#avar_cognate_test <- avar_cognate_test[which(avar_cognate_test$Present == 1),]
#avar_cognate_test <- merge(avar_cognate_test, words_meta, by= c("SpkrLexeme"))
#avar_cognate_test <- distinct (avar_cognate_test)
#avar_cognate_test <- avar_cognate_test %>%
#  select(`Speaker`, Language.x, Village.x, District.x, Lexeme.x, `List ID`, Concept, `Concept nr.`, Word, Stem, Set)
#write_tsv(avar_cognate_test, "Avar_Cognate_Test.tsv")

kusur_cognate_test <- as.data.frame(t(d[which(d$Kusur1 == 1 & d$D_Avar == 1 & d$D_Arabic != 1 & d$D_Persian != 1 & d$Turk_total == 0),]))
kusur_cognate_test$Speaker <- rownames(kusur_cognate_test)
kusur_cognate_test <- left_join(Districts, kusur_cognate_test, by= c("Speaker"))
kusur_cognate_test <- gather(kusur_cognate_test,Lexeme,Present, the_ant_20:the_worm_16,factor_key=TRUE)
kusur_cognate_test <- kusur_cognate_test[kusur_cognate_test$Village %in% c("Kusur") | kusur_cognate_test$Speaker %in% c("D_Avar"),]
kusur_cognate_test <- kusur_cognate_test[which(kusur_cognate_test$Present == 1),]
words_meta$Lexeme <- paste(gsub(" ", "_", words_meta$Concept, fixed = TRUE), words_meta$Stem, sep = "_")
words_meta$SpkrLexeme <- paste(words_meta$Code, words_meta$Lexeme, sep = "_")
kusur_cognate_test$SpkrLexeme <- paste(kusur_cognate_test$Speaker, kusur_cognate_test$Lexeme, sep = "_")
kusur_cognate_test <- kusur_cognate_test[which(kusur_cognate_test$Present == 1),]
kusur_cognate_test <- merge(kusur_cognate_test, words_meta, by= c("SpkrLexeme"))
kusur_cognate_test <- distinct (kusur_cognate_test)
kusur_cognate_test <- kusur_cognate_test %>%
  select(`Speaker`, Language.x, Village.x, District.x, Lexeme.x, `List ID`, Concept, `Concept nr.`, Word, Stem, Set)
write_tsv(kusur_cognate_test, "kusur_cognate_Test.tsv")




georgian <-  as.data.frame(t(d[which(d$D_Georgian>0 & d$D_Russian != 1 & d$D_Arabic != 1 & d$D_Persian != 1 & d$Turk_total == 0),]))
georgian$Speaker <- rownames(georgian)
georgian <- left_join(Districts, georgian, by= c("Speaker"))
#georgian$District <- as.factor(georgian$District)
georgian <- georgian[georgian$District %in% c("Akhvakh", "Botlikh", "Rutul", "Tsunta"),]
georgian$District <- factor(georgian$District, levels(georgian$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#georgian$District <- as.factor(georgian$District)
georgian <- gather(georgian,Lexeme,Present, the_ant_1:the_year_5,factor_key=TRUE)
#head(georgian)

chechen <-  as.data.frame(t(d[which(d$D_Chechen>0 & d$D_Russian != 1 & d$D_Arabic != 1 & d$D_Persian != 1 & d$Turk_total == 0),]))
chechen$Speaker <- rownames(chechen)
chechen <- left_join(Districts, chechen, by= c("Speaker"))
#chechen$District <- as.factor(chechen$District)
chechen <- chechen[chechen$District %in% c("Akhvakh", "Botlikh", "Rutul", "Tsunta"),]
chechen$District <- factor(chechen$District, levels(chechen$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#chechen$District <- as.factor(chechen$District)
chechen <- gather(chechen,Lexeme,Present, the_ant_9:the_worm_28,factor_key=TRUE)
#head(chechen)

all_turkic_counts <- aggregate(all_turkic$Present, by=list(all_turkic$Speaker), FUN=sum, na.rm=TRUE, na.action=NULL)
#head(all_turkic_counts)
colnames(all_turkic_counts) <- c("Speaker","Loans")
all_turkic_counts <- left_join(all_turkic_counts, Districts, by= c("Speaker"))
all_turkic_counts$Village <- droplevels(all_turkic_counts$Village)
all_turkic_counts$District <- factor(all_turkic_counts$District, levels(all_turkic$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#all_turkic_counts <- all_turkic_counts[-c(1:6),]
all_turkic_counts$Loans <- as.numeric(all_turkic_counts$Loans)

avar_counts <- aggregate(avar$Present, by=list(avar$Speaker), FUN=sum, na.rm=TRUE, na.action=NULL)
#head(avar_counts)
colnames(avar_counts) <- c("Speaker","Loans")
avar_counts <- left_join(avar_counts, Districts, by= c("Speaker"))
avar_counts$Village <- droplevels(avar_counts$Village)
avar_counts$District <- factor(avar_counts$District, levels(avar$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#avar_counts <- avar_counts[-c(1:6),]
avar_counts$Loans <- as.numeric(avar_counts$Loans)

georgian_counts <- aggregate(georgian$Present, by=list(georgian$Speaker), FUN=sum, na.rm=TRUE, na.action=NULL)
#head(georgian_counts)
colnames(georgian_counts) <- c("Speaker","Loans")
georgian_counts <- left_join(georgian_counts, Districts, by= c("Speaker"))
georgian_counts$Village <- droplevels(georgian_counts$Village)
georgian_counts$District <- factor(georgian_counts$District, levels(georgian$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#georgian_counts <- georgian_counts[-c(1:6),]
georgian_counts$Loans <- as.numeric(georgian_counts$Loans)

chechen_counts <- aggregate(chechen$Present, by=list(chechen$Speaker), FUN=sum, na.rm=TRUE, na.action=NULL)
#head(chechen_counts)
colnames(chechen_counts) <- c("Speaker","Loans")
chechen_counts <- left_join(chechen_counts, Districts, by= c("Speaker"))
chechen_counts$Village <- droplevels(chechen_counts$Village)
chechen_counts$District <- factor(chechen_counts$District, levels(chechen$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#chechen_counts <- chechen_counts[-c(1:6),]
chechen_counts$Loans <- as.numeric(chechen_counts$Loans)

all_turkic_counts$Source <- rep("Turkic",nrow(all_turkic_counts))
avar_counts$Source <- rep("Avar",nrow(avar_counts))
georgian_counts$Source <- rep("Georgian",nrow(georgian_counts))
chechen_counts$Source <- rep("Chechen",nrow(chechen_counts))
loan_counts <- rbind(all_turkic_counts, avar_counts, georgian_counts, chechen_counts)

Area <- factor(loan_counts$District, levels  = c("Rutul","Tsunta","Botlikh","Akhvakh"))
p1 <- ggplot(data = loan_counts, aes(x = Area, y = Loans)) + 
    geom_jitter(aes(color = Village), position = position_jitter(width = 0.3, height = 0.1)) +
    stat_summary(fun.y = "median", geom = "point", pch = 3, group = 1, size = 5)+
    labs(title = "Fig. 1. Foreign Influence", x = "District", y = "Number of Loanwords")+
    theme_bw()+
    facet_wrap(. ~ factor(Source, levels = c("Turkic", "Avar", "Georgian", "Chechen")), nrow = 1, scales = "free")+
    theme(legend.position = "bottom")
#p5
#par(mfcol=c(1,4))
#library(gridExtra)
library(plotly)
ggplotly(p1) %>%
  layout(legend = list(
    size = 30
    )
  )

#subplot(p1,p2,p3,p4)

#grid.arrange(ggplotly(p1), ggplotly(p2), ggplotly(p3), ggplotly(p4), nrow = 1)
#lemon::grid_arrange_shared_legend(ggplotly(p1), ggplotly(p2), ggplotly(p3), ggplotly(p4), nrow = 1)
#subplot(p1, p2, p3, p4) %>%
#  layout(showlegend = FALSE)
```


```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width = 9, fig.height= 7}
#These functions count the necessary distances
#div_count <- function(string1, string2){
#  x <- unlist(string1, use.names = F)
#  y <- unlist(string2, use.names = F)
#  d <- data.frame(x, y)
#  #print(d)
#  num <- sum(complete.cases(d))
#  return(num)
#}

# dissimilarity matrix -------------------------------------------------
#dist_count <- function(data) {
#  data2 <- data.frame()
#  for (i in row.names(data)) {
#    for (j in row.names(data)) {
      #print(data[i,])
      #print(data[j,])
#      data2[i,j] = round(sum((data[i,]!=data[j,]), na.rm=TRUE)/div_count(data[i,],data[j,]), digits=2)
#      #print (round(sum((data[i,]!=data[j,]), na.rm=TRUE)/div_count(data[i,],data[j,]), digits=2))
#    }
#  }
#  return(data2)
#}
```

```{r, echo=FALSE,  eval = FALSE, message=FALSE, warning=FALSE, fig.width = 9, fig.height= 7}
#library(dendextend)
#library(pvclust)

#d_no_dict <- d
#d_no_dict$Turkic_total <- NULL
#d_no_dict$AvarAndic_total <- NULL
#d_no_dict <- as.data.frame(t(d_no_dict))
#d_no_dict$Speaker <- row.names(d_no_dict)
#d_no_dict <- left_join(Districts, d_no_dict, by= c("Speaker"))
#d_no_dict <- d_no_dict[-which(d_no_dict$Village == "Dictionary"),]
#row.names(d_no_dict) <- d_no_dict$Speaker
#d_no_dict <- d_no_dict[,-c(1:4)]
#d_no_dict <- as.matrix(d_no_dict)

#full_dist <- dist_count(d_no_dict)
#result <- pvclust::pvclust(as.matrix(full_dist, method.hclust="average", nboot=1000))
#d_no_dict_colors <-  full_dist
#d_no_dict_colors$Speaker <- row.names(d_no_dict_colors)
#d_no_dict_colors <- left_join(Districts, d_no_dict_colors, by= c("Speaker"))
#d_no_dict_colors <- d_no_dict_colors[-which(d_no_dict_colors$Village == "Dictionary"),]
#d_no_dict_colors$Turkic_total <- NULL
#d_no_dict_colors$AvarAndic_total <- NULL
#d_no_dict_colors %>% arrange(Speaker)
#row.names(d_no_dict_colors) <- c(1:length(d_no_dict_colors$Speaker))
#lbl <- cbind(result$hclust$label, result$hclust$order)
#colnames(lbl) <- c("Speaker", "Number")
#lbl <- as.data.frame(lbl)
#dstrct <- c()
#for (number in lbl$Number){
#  dstrct <- c(dstrct, d_no_dict_colors$District[as.integer(number)])
#}

#lbl$District <- dstrct


#dend <- as.dendrogram(result)
#dend <- set(dend, "labels_colors", as.integer(as.factor(lbl$District))) 
#dend <- set(dend, "labels_cex", .7)
#dend %>%
#   pvclust_show_signif_gradient(result) %>%
#   pvclust_show_signif(result) %>%
#   plot(main = "Cluster Dendrogram of Foreign Influence")
#result %>% text(cex = 0.5)
#result %>% pvrect(alpha=0.95)

```

##Mediation of Turkic influence (Speakers)

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width = 9, fig.height= 7}
all_turkic_in_Lezgi <-  as.data.frame(t(d[which(d$Turk_total>0 & d$D_Russian != 1 & d$D_Arabic != 1 & d$D_Persian != 1 & d$D_Lezgian == 1),]))
all_turkic_not_in_Lezgi <-  as.data.frame(t(d[which(d$Turk_total>0 & d$D_Russian != 1 & d$D_Arabic != 1 & d$D_Persian != 1 & d$D_Lezgian != 1),]))

all_turkic_in_Lezgi$Speaker <- rownames(all_turkic_in_Lezgi)
all_turkic_in_Lezgi <- left_join(Districts, all_turkic_in_Lezgi, by= c("Speaker"))
#head(all_turkic)
all_turkic_not_in_Lezgi$Speaker <- rownames(all_turkic_not_in_Lezgi)
all_turkic_not_in_Lezgi <- left_join(Districts, all_turkic_not_in_Lezgi, by= c("Speaker"))
#all_turkic$District <- as.factor(all_turkic$District)
#all_turkic$District <- factor(all_turkic$District, levels(all_turkic$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#all_turkic$District <- as.factor(all_turkic$District)
all_turkic_in_Lezgi <- gather(all_turkic_in_Lezgi,Lexeme,Present, the_beak_22:the_wolf_2,factor_key=TRUE)
all_turkic_not_in_Lezgi <- gather(all_turkic_not_in_Lezgi,Lexeme,Present, the_ant_5:the_year_2,factor_key=TRUE)
all_turkic_in_Lezgi$InLezgi <- rep("1",nrow(all_turkic_in_Lezgi))
all_turkic_not_in_Lezgi$InLezgi <- rep("0",nrow(all_turkic_not_in_Lezgi))
all_turkic_lezgi_mediation <- rbind(all_turkic_in_Lezgi, all_turkic_not_in_Lezgi)

all_turkic_lezgi_mediation_counts <- aggregate(all_turkic_lezgi_mediation$Present, by=list(all_turkic_lezgi_mediation$Speaker, all_turkic_lezgi_mediation$InLezgi), FUN=sum, na.rm=TRUE, na.action=NULL)
#head(all_turkic_lezgi_mediation_counts)
colnames(all_turkic_lezgi_mediation_counts) <- c("Speaker","InLezgi","Loans")
all_turkic_lezgi_mediation_counts <- left_join(all_turkic_lezgi_mediation_counts, Districts, by= c("Speaker"))
all_turkic_lezgi_mediation_counts$Village <- droplevels(all_turkic_lezgi_mediation_counts$Village)
all_turkic_lezgi_mediation_counts$District <- factor(all_turkic_lezgi_mediation_counts$District, levels(all_turkic_lezgi_mediation$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#all_turkic_lezgi_mediation_counts <- all_turkic_lezgi_mediation_counts[-c(1:6),]
all_turkic_lezgi_mediation_counts$Loans <- as.numeric(all_turkic_lezgi_mediation_counts$Loans)

all_turkic_lezgi_mediation_counts <- all_turkic_lezgi_mediation_counts[all_turkic_lezgi_mediation_counts$District %in% c("Akhvakh", "Botlikh", "Rutul", "Tsunta"),]
#all_turkic_lezgi_mediation_counts <- all_turkic_lezgi_mediation_counts[-which(all_turkic_lezgi_mediation_counts$Village == "Khlyut"),]
all_turkic_lezgi_mediation_counts$District <- factor(all_turkic_lezgi_mediation_counts$District, levels(all_turkic_lezgi_mediation_counts$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
all_turkic_lezgi_mediation_counts$Village <- factor(all_turkic_lezgi_mediation_counts$Village)

Area <- factor(all_turkic_lezgi_mediation_counts$District, levels  = c("Rutul","Tsunta","Botlikh","Akhvakh"))
p2 <- ggplot(data = all_turkic_lezgi_mediation_counts, aes(x = InLezgi, y = Loans)) + 
    geom_jitter(aes(color = Village), position = position_jitter(width = 0.3, height = 0.1)) +
    stat_summary(fun.y = "median", geom = "point", pch = 3, group = 1, size = 5)+
    labs(title = "Fig. 2. Lezgian Mediation of Turkic Influence", x = "In Lezgian", y = "Number of Loanwords")+
    theme_bw()+
    facet_wrap(. ~ factor(District), nrow = 1, scales = "free")+
    theme(legend.position = "bottom")
ggplotly(p2)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width = 9, fig.height= 7}
all_turkic_in_avar <-  as.data.frame(t(d[which(d$Turk_total>0 & d$D_Russian != 1 & d$D_Arabic != 1 & d$D_Persian != 1 & d$D_Avar == 1),]))
all_turkic_not_in_avar <-  as.data.frame(t(d[which(d$Turk_total>0 & d$D_Russian != 1 & d$D_Arabic != 1 & d$D_Persian != 1 & d$D_Avar != 1),]))

all_turkic_in_avar$Speaker <- rownames(all_turkic_in_avar)
all_turkic_in_avar <- left_join(Districts, all_turkic_in_avar, by= c("Speaker"))
#head(all_turkic)
all_turkic_not_in_avar$Speaker <- rownames(all_turkic_not_in_avar)
all_turkic_not_in_avar <- left_join(Districts, all_turkic_not_in_avar, by= c("Speaker"))
#all_turkic$District <- as.factor(all_turkic$District)
#all_turkic$District <- factor(all_turkic$District, levels(all_turkic$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#all_turkic$District <- as.factor(all_turkic$District)
all_turkic_in_avar <- gather(all_turkic_in_avar,Lexeme,Present, the_belt_15:the_worm_31,factor_key=TRUE)
all_turkic_not_in_avar <- gather(all_turkic_not_in_avar,Lexeme,Present, the_ant_5:the_year_2,factor_key=TRUE)
all_turkic_in_avar$InAvar <- rep("1",nrow(all_turkic_in_avar))
all_turkic_not_in_avar$InAvar <- rep("0",nrow(all_turkic_not_in_avar))
all_turkic_avar_mediation <- rbind(all_turkic_in_avar, all_turkic_not_in_avar)

all_turkic_avar_mediation_counts <- aggregate(all_turkic_avar_mediation$Present, by=list(all_turkic_avar_mediation$Speaker, all_turkic_avar_mediation$InAvar), FUN=sum, na.rm=TRUE, na.action=NULL)
#head(all_turkic_avar_mediation_counts)
colnames(all_turkic_avar_mediation_counts) <- c("Speaker","InAvar","Loans")
all_turkic_avar_mediation_counts <- left_join(all_turkic_avar_mediation_counts, Districts, by= c("Speaker"))
all_turkic_avar_mediation_counts$Village <- droplevels(all_turkic_avar_mediation_counts$Village)
all_turkic_avar_mediation_counts$District <- factor(all_turkic_avar_mediation_counts$District, levels(all_turkic_avar_mediation$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#all_turkic_avar_mediation_counts <- all_turkic_avar_mediation_counts[-c(1:6),]
all_turkic_avar_mediation_counts$Loans <- as.numeric(all_turkic_avar_mediation_counts$Loans)

all_turkic_avar_mediation_counts <- all_turkic_avar_mediation_counts[all_turkic_avar_mediation_counts$District %in% c("Akhvakh", "Botlikh", "Rutul", "Tsunta"),]
all_turkic_avar_mediation_counts$District <- factor(all_turkic_avar_mediation_counts$District, levels(all_turkic_avar_mediation_counts$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))

Area <- factor(all_turkic_avar_mediation_counts$District, levels  = c("Rutul","Tsunta","Botlikh","Akhvakh"))
p3 <- ggplot(data = all_turkic_avar_mediation_counts, aes(x = InAvar, y = Loans)) + 
    geom_jitter(aes(color = Village), position = position_jitter(width = 0.3, height = 0.1)) +
    stat_summary(fun.y = "median", geom = "point", pch = 3, group = 1, size = 5)+
    labs(title = "Fig. 3. Avar Mediation of Turkic Influence", x = "In Avar", y = "Number of Loanwords")+
    theme_bw()+
    facet_wrap(. ~ factor(District), nrow = 1, scales = "free")+
    theme(legend.position = "bottom")
ggplotly(p3)
```

##Mediation of Turkic influence (Villages)
```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width = 9, fig.height= 7}
all_turkic_in_Lezgi <-  as.data.frame(t(d[which(d$Turk_total>0 & d$D_Russian != 1 & d$D_Arabic != 1 & d$D_Persian != 1 & d$D_Lezgian == 1),]))
all_turkic_not_in_Lezgi <-  as.data.frame(t(d[which(d$Turk_total>0 & d$D_Russian != 1 & d$D_Arabic != 1 & d$D_Persian != 1 & d$D_Lezgian != 1),]))

all_turkic_in_Lezgi$Speaker <- rownames(all_turkic_in_Lezgi)
all_turkic_in_Lezgi <- left_join(Districts, all_turkic_in_Lezgi, by= c("Speaker"))
#head(all_turkic)
all_turkic_not_in_Lezgi$Speaker <- rownames(all_turkic_not_in_Lezgi)
all_turkic_not_in_Lezgi <- left_join(Districts, all_turkic_not_in_Lezgi, by= c("Speaker"))
#all_turkic$District <- as.factor(all_turkic$District)
#all_turkic$District <- factor(all_turkic$District, levels(all_turkic$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#all_turkic$District <- as.factor(all_turkic$District)
all_turkic_in_Lezgi <- gather(all_turkic_in_Lezgi,Lexeme,Present, the_beak_22:the_wolf_2,factor_key=TRUE)
all_turkic_not_in_Lezgi <- gather(all_turkic_not_in_Lezgi,Lexeme,Present, the_ant_5:the_year_2,factor_key=TRUE)
all_turkic_in_Lezgi$InLezgi <- rep("1",nrow(all_turkic_in_Lezgi))
all_turkic_not_in_Lezgi$InLezgi <- rep("0",nrow(all_turkic_not_in_Lezgi))
all_turkic_lezgi_mediation <- rbind(all_turkic_in_Lezgi, all_turkic_not_in_Lezgi)

all_turkic_lezgi_mediation <- all_turkic_lezgi_mediation[,-1]
all_turkic_lezgi_mediation <- distinct(all_turkic_lezgi_mediation)
all_turkic_lezgi_mediation_counts <- aggregate(all_turkic_lezgi_mediation$Present, by=list(all_turkic_lezgi_mediation$Village, all_turkic_lezgi_mediation$InLezgi), FUN=sum, na.rm=TRUE, na.action=NULL)
#head(all_turkic_lezgi_mediation_counts)
colnames(all_turkic_lezgi_mediation_counts) <- c("Village","InLezgi","Loans")
all_turkic_lezgi_mediation_counts <- left_join(all_turkic_lezgi_mediation_counts, Districts, by= c("Village"))
all_turkic_lezgi_mediation_counts$Village <- droplevels(all_turkic_lezgi_mediation_counts$Village)
all_turkic_lezgi_mediation_counts$District <- factor(all_turkic_lezgi_mediation_counts$District, levels(all_turkic_lezgi_mediation$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#all_turkic_lezgi_mediation_counts <- all_turkic_lezgi_mediation_counts[-c(1:6),]
all_turkic_lezgi_mediation_counts$Loans <- as.numeric(all_turkic_lezgi_mediation_counts$Loans)

all_turkic_lezgi_mediation_counts <- all_turkic_lezgi_mediation_counts[all_turkic_lezgi_mediation_counts$District %in% c("Akhvakh", "Botlikh", "Rutul", "Tsunta"),]
#all_turkic_lezgi_mediation_counts <- all_turkic_lezgi_mediation_counts[-which(all_turkic_lezgi_mediation_counts$Village == "Khlyut"),]
all_turkic_lezgi_mediation_counts$District <- factor(all_turkic_lezgi_mediation_counts$District, levels(all_turkic_lezgi_mediation_counts$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
all_turkic_lezgi_mediation_counts$Village <- factor(all_turkic_lezgi_mediation_counts$Village)

all_turkic_lezgi_mediation_counts <- all_turkic_lezgi_mediation_counts[,-4]
all_turkic_lezgi_mediation_counts <- distinct(all_turkic_lezgi_mediation_counts)
Area <- factor(all_turkic_lezgi_mediation_counts$District, levels  = c("Rutul","Tsunta","Botlikh","Akhvakh"))
p2 <- ggplot(data = all_turkic_lezgi_mediation_counts, aes(x = InLezgi, y = Loans)) + 
    geom_jitter(aes(color = Village), position = position_jitter(width = 0.3, height = 0.1)) +
    stat_summary(fun.y = "median", geom = "point", pch = 3, group = 1, size = 5)+
    labs(title = "Fig. 2. Lezgian Mediation of Turkic Influence", x = "In Lezgian", y = "Number of Loanwords")+
    theme_bw()+
    facet_wrap(. ~ factor(District), nrow = 1, scales = "free")+
    theme(legend.position = "bottom")
ggplotly(p2)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width = 9, fig.height= 7}
all_turkic_in_avar <-  as.data.frame(t(d[which(d$Turk_total>0 & d$D_Russian != 1 & d$D_Arabic != 1 & d$D_Persian != 1 & d$D_Avar == 1),]))
all_turkic_not_in_avar <-  as.data.frame(t(d[which(d$Turk_total>0 & d$D_Russian != 1 & d$D_Arabic != 1 & d$D_Persian != 1 & d$D_Avar != 1),]))

all_turkic_in_avar$Speaker <- rownames(all_turkic_in_avar)
all_turkic_in_avar <- left_join(Districts, all_turkic_in_avar, by= c("Speaker"))
#head(all_turkic)
all_turkic_not_in_avar$Speaker <- rownames(all_turkic_not_in_avar)
all_turkic_not_in_avar <- left_join(Districts, all_turkic_not_in_avar, by= c("Speaker"))
#all_turkic$District <- as.factor(all_turkic$District)
#all_turkic$District <- factor(all_turkic$District, levels(all_turkic$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#all_turkic$District <- as.factor(all_turkic$District)
all_turkic_in_avar <- gather(all_turkic_in_avar,Lexeme,Present, the_belt_15:the_worm_31,factor_key=TRUE)
all_turkic_not_in_avar <- gather(all_turkic_not_in_avar,Lexeme,Present, the_ant_5:the_year_2,factor_key=TRUE)
all_turkic_in_avar$InAvar <- rep("1",nrow(all_turkic_in_avar))
all_turkic_not_in_avar$InAvar <- rep("0",nrow(all_turkic_not_in_avar))
all_turkic_avar_mediation <- rbind(all_turkic_in_avar, all_turkic_not_in_avar)

all_turkic_avar_mediation <- all_turkic_avar_mediation[,-1]
all_turkic_avar_mediation <- distinct(all_turkic_avar_mediation)
all_turkic_avar_mediation_counts <- aggregate(all_turkic_avar_mediation$Present, by=list(all_turkic_avar_mediation$Village, all_turkic_avar_mediation$InAvar), FUN=sum, na.rm=TRUE, na.action=NULL)
#head(all_turkic_avar_mediation_counts)
colnames(all_turkic_avar_mediation_counts) <- c("Village","InAvar","Loans")
all_turkic_avar_mediation_counts <- left_join(all_turkic_avar_mediation_counts, Districts, by= c("Village"))
all_turkic_avar_mediation_counts$Village <- droplevels(all_turkic_avar_mediation_counts$Village)
all_turkic_avar_mediation_counts$District <- factor(all_turkic_avar_mediation_counts$District, levels(all_turkic_avar_mediation$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))
#all_turkic_avar_mediation_counts <- all_turkic_avar_mediation_counts[-c(1:6),]
all_turkic_avar_mediation_counts$Loans <- as.numeric(all_turkic_avar_mediation_counts$Loans)

all_turkic_avar_mediation_counts <- all_turkic_avar_mediation_counts[all_turkic_avar_mediation_counts$District %in% c("Akhvakh", "Botlikh", "Rutul", "Tsunta"),]
all_turkic_avar_mediation_counts$District <- factor(all_turkic_avar_mediation_counts$District, levels(all_turkic_avar_mediation_counts$District) <- c("Akhvakh", "Botlikh", "Rutul", "Tsunta"))

all_turkic_avar_mediation_counts <- all_turkic_avar_mediation_counts[,-4]
all_turkic_avar_mediation_counts <- distinct(all_turkic_avar_mediation_counts)
Area <- factor(all_turkic_avar_mediation_counts$District, levels  = c("Rutul","Tsunta","Botlikh","Akhvakh"))
p3 <- ggplot(data = all_turkic_avar_mediation_counts, aes(x = InAvar, y = Loans)) + 
    geom_jitter(aes(color = Village), position = position_jitter(width = 0.3, height = 0.1)) +
    stat_summary(fun.y = "median", geom = "point", pch = 3, group = 1, size = 5)+
    labs(title = "Fig. 3. Avar Mediation of Turkic Influence", x = "In Avar", y = "Number of Loanwords")+
    theme_bw()+
    facet_wrap(. ~ factor(District), nrow = 1, scales = "free")+
    theme(legend.position = "bottom")
ggplotly(p3)
```

