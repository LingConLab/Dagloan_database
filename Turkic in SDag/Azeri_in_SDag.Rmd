---
title: "Azeri Influence in Southern Daghestan"
author: "Ilia Chechuro"
date: "13 2 2019"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r echo = FALSE}
library(tidyverse)
library(ggplot2)

turkic <- read.csv("SDag_Dataframe.csv", header = TRUE, sep = ",", na.strings = "NA", row.names = NULL)
row.names(turkic) <- turkic[,1]
turkic_long <- gather(turkic, Lexeme, Present, the_ant_1:the_year_12, factor_key=TRUE)
regions <- turkic[,c(1:2)]
regions <- cbind(row.names(regions), regions)
regions <- as.data.frame(regions)
colnames(regions)[1] <- "village"
regions$village <- as.character(regions$village)
regions$village = substr(regions$village,1,nchar(regions$village)-1)
regions$village <- as.factor(regions$village)
levels(regions$Region) <- c("Tabasaran", "Khiv", "Rutul", "Tsakhur", "Tabasaran_Azeri", "Qax_Azeri")
turkic <- turkic[,-c(1:2)]
turkic <- t(turkic)
turkic <- as.data.frame(turkic)
```
1. Preparing data: 
```{r, echo = FALSE}
standard_azeri <-  as.data.frame(t(turkic[which(turkic$D_Azerbaijani==1),]))
standard_azeri$Speaker <- rownames(standard_azeri)
standard_azeri <- left_join(regions, standard_azeri, by= c("Speaker"))
standard_azeri$Region <- as.factor(standard_azeri$Region)
standard_azeri <- standard_azeri[-c(1:6),]
standard_azeri <- gather(standard_azeri,Lexeme,Present, the_ant_5:the_year_2,factor_key=TRUE)
toBeRemoved<-which(standard_azeri$Region %in% c("Tabasaran_Azeri", "Qax_Azeri"))
standard_azeri<-standard_azeri[-toBeRemoved,]

all_azeri <- as.data.frame(t(turkic[which(turkic$Turkic_Total>0),]))
all_azeri$Speaker <- rownames(all_azeri)
all_azeri <- left_join(regions, all_azeri, by= c("Speaker"))
all_azeri$Region <- as.factor(all_azeri$Region)
levels(all_azeri$Region) <- c("Tabasaran", "Khiv", "Rutul", "Tsakhur", "Tabasaran_Azeri", "Qax_Azeri")
all_azeri$Region <- as.factor(all_azeri$Region)
all_azeri <- all_azeri[-c(1:6),]
all_azeri <- gather(all_azeri,Lexeme,Present, the_ant_5:the_year_2,factor_key=TRUE)
toBeRemoved<-which(all_azeri$Region %in% c("Tabasaran_Azeri", "Qax_Azeri"))
all_azeri<-all_azeri[-toBeRemoved,]

tabasaran_azeri  <- as.data.frame(t(turkic[which(turkic$Darvag_Yersi_total>0 & turkic$Qax_Total == 0 & turkic$D_Azerbaijani == 0 & turkic$D_Kumyk == 0),]))
tabasaran_azeri$Speaker <- rownames(tabasaran_azeri)
tabasaran_azeri <- left_join(regions, tabasaran_azeri, by= c("Speaker"))
tabasaran_azeri$Region <- as.factor(tabasaran_azeri$Region)
tabasaran_azeri <- tabasaran_azeri[-c(1:6),]
tabasaran_azeri <- gather(tabasaran_azeri,Lexeme,Present, the_ant_12:the_worm_23,factor_key=TRUE)
toBeRemoved<-which(tabasaran_azeri$Region %in% c("Tabasaran_Azeri", "Qax_Azeri"))
tabasaran_azeri<-tabasaran_azeri[-toBeRemoved,]

qax_azeri  <- as.data.frame(t(turkic[which(turkic$Darvag_Yersi_total == 0 & turkic$Qax_Total > 0 & turkic$D_Azerbaijani == 0 & turkic$D_Kumyk == 0),]))
qax_azeri$Speaker <- rownames(qax_azeri)
qax_azeri <- left_join(regions, qax_azeri, by= c("Speaker"))
qax_azeri$Region <- as.factor(qax_azeri$Region)
qax_azeri <- qax_azeri[-c(1:6),]
qax_azeri <- gather(qax_azeri,Lexeme,Present, the_blanket_8:the_worm_9,factor_key=TRUE)
toBeRemoved<-which(qax_azeri$Region %in% c("Tabasaran_Azeri", "Qax_Azeri"))
qax_azeri<-qax_azeri[-toBeRemoved,]

dialect_azeri  <- as.data.frame(t(turkic[which(turkic$Azeri_Dialect_Total > 0 & turkic$D_Azerbaijani == 0 & turkic$D_Kumyk == 0),]))
dialect_azeri$Speaker <- rownames(dialect_azeri)
dialect_azeri <- left_join(regions, dialect_azeri, by= c("Speaker"))
dialect_azeri$Region <- as.factor(dialect_azeri$Region)
dialect_azeri <- dialect_azeri[-c(1:6),]
dialect_azeri <- gather(dialect_azeri,Lexeme,Present, the_ant_12:the_worm_23,factor_key=TRUE)
toBeRemoved<-which(dialect_azeri$Region %in% c("Qax_Azeri", "Tabasaran_Azeri"))
dialect_azeri<-dialect_azeri[-toBeRemoved,]

nodict_azeri  <- as.data.frame(t(turkic[which(turkic$D_Azerbaijani == 0),]))
nodict_azeri$Speaker <- rownames(nodict_azeri)
nodict_azeri <- left_join(regions, nodict_azeri, by= c("Speaker"))
nodict_azeri$Region <- as.factor(nodict_azeri$Region)
nodict_azeri <- nodict_azeri[-c(1:6),]
nodict_azeri <- gather(nodict_azeri,Lexeme,Present, the_ant_12:the_worm_23,factor_key=TRUE)
toBeRemoved<-which(nodict_azeri$Region %in% c("Tabasaran", "Khiv", "Rutul", "Tsakhur"))
nodict_azeri<-nodict_azeri[-toBeRemoved,]

nodictkum_azeri  <- as.data.frame(t(turkic[which(turkic$D_Azerbaijani == 0 & turkic$D_Kumyk == 0),]))
nodictkum_azeri$Speaker <- rownames(nodictkum_azeri)
nodictkum_azeri <- left_join(regions, nodictkum_azeri, by= c("Speaker"))
nodictkum_azeri$Region <- as.factor(nodictkum_azeri$Region)
nodictkum_azeri <- nodictkum_azeri[-c(1:6),]
nodictkum_azeri <- gather(nodictkum_azeri,Lexeme,Present, the_ant_12:the_worm_23,factor_key=TRUE)
toBeRemoved<-which(nodictkum_azeri$Region %in% c("Tabasaran", "Khiv", "Rutul", "Tsakhur"))
nodictkum_azeri<-nodictkum_azeri[-toBeRemoved,]

```

```{r}
par(mfrow=c(2,3))
```

2. Medians of Standard Azeri influence:
```{r, echo = FALSE}
standard_azeri_counts <- aggregate(standard_azeri$Present, by=list(standard_azeri$Speaker), FUN=sum, na.rm=TRUE, na.action=NULL)
colnames(standard_azeri_counts) <- c("Speaker","Turkic_Loans")
standard_azeri_counts <- left_join(regions, standard_azeri_counts, by= c("Speaker"))
standard_azeri_counts$Region <- as.factor(standard_azeri_counts$Region)
standard_azeri_counts$village <- as.factor(standard_azeri_counts$village)
standard_azeri_counts <- standard_azeri_counts[-c(1:6),]
toBeRemoved<-which(standard_azeri_counts$Region %in% c("Tabasaran_Azeri", "Qax_Azeri"))
standard_azeri_counts<-standard_azeri_counts[-toBeRemoved,]
standard_azeri_counts$Region <- droplevels(standard_azeri_counts$Region)
standard_azeri_counts$Region <- factor(standard_azeri_counts$Region, levels=c("Tabasaran", "Khiv", "Rutul", "Tsakhur"))
p1 <- ggplot(data = standard_azeri_counts, aes(x = Region, y = Turkic_Loans)) + 
    geom_jitter(aes(color = factor(village)), position = position_jitter(width = 0.1, height = 0.1)) +
    # levels = c("Dyubek","Tatil","Khapil","Yagdyg","Khiv","Laka","Khoredzh","Kiche","Rutul","Kina","Ikhrek", "Helmets", "Mikik")
    stat_summary(fun.y = "median", geom = "point", pch = "_", size = 15)+
    labs(title = "Standard Azerbaijani Influence", x = "Region", y = "Number of Loanwords")+
    theme_bw()+
    theme(legend.position = "none")
  
```

3. Medians of All Azeri influence:
```{r, echo = FALSE}
all_azeri_counts <- aggregate(all_azeri$Present, by=list(all_azeri$Speaker), FUN=sum, na.rm=TRUE, na.action=NULL)
colnames(all_azeri_counts) <- c("Speaker","Turkic_Loans")
all_azeri_counts <- left_join(regions, all_azeri_counts, by= c("Speaker"))
all_azeri_counts$Region <- as.factor(all_azeri_counts$Region)
all_azeri_counts <- all_azeri_counts[-c(1:6),]
toBeRemoved<-which(all_azeri_counts$Region %in% c("Tabasaran_Azeri", "Qax_Azeri"))
all_azeri_counts<-all_azeri_counts[-toBeRemoved,]
all_azeri_counts$Region <- factor(all_azeri_counts$Region, levels=c("Tabasaran", "Khiv", "Rutul", "Tsakhur"))
p2 <- ggplot(data = all_azeri_counts, aes(x = Region, y = Turkic_Loans)) + 
    geom_jitter(aes(color = factor(village)), position = position_jitter(width = 0.1, height = 0.1)) +
    # levels = c("Dyubek","Tatil","Khapil","Yagdyg","Khiv","Laka","Khoredzh","Kiche","Rutul","Kina","Ikhrek", "Helmets", "Mikik")
    stat_summary(fun.y = "median", geom = "point", pch = "_", size = 15)+
    labs(title = "Total Turkic Influence", x = "Region", y = "Number of Loanwords")+
    theme_bw()+
    theme(legend.position = "none")
```
4. Medians of Tabasaran Azeri influence:
```{r, echo = FALSE}
tabasaran_azeri_counts <- aggregate(tabasaran_azeri$Present, by=list(tabasaran_azeri$Speaker), FUN=sum, na.rm=TRUE, na.action=NULL)
colnames(tabasaran_azeri_counts) <- c("Speaker","Turkic_Loans")
tabasaran_azeri_counts <- left_join(regions, tabasaran_azeri_counts, by= c("Speaker"))
tabasaran_azeri_counts$Region <- as.factor(tabasaran_azeri_counts$Region)
tabasaran_azeri_counts <- tabasaran_azeri_counts[-c(1:6),]
toBeRemoved<-which(tabasaran_azeri_counts$Region %in% c("Tabasaran_Azeri", "Qax_Azeri"))
tabasaran_azeri_counts<-tabasaran_azeri_counts[-toBeRemoved,]
tabasaran_azeri_counts$Region <- factor(tabasaran_azeri_counts$Region, levels=c("Tabasaran", "Khiv", "Rutul", "Tsakhur"))

p3 <- ggplot(data = tabasaran_azeri_counts, aes(x = Region, y = Turkic_Loans)) + 
    geom_jitter(aes(color = factor(village)), position = position_jitter(width = 0.1, height = 0.1)) +
    # levels = c("Dyubek","Tatil","Khapil","Yagdyg","Khiv","Laka","Khoredzh","Kiche","Rutul","Kina","Ikhrek", "Helmets", "Mikik")
    stat_summary(fun.y = "median", geom = "point", pch = "_", size = 15)+
    labs(title = "Tabasaran Azerbaijani Influence", x = "Region", y = "Number of Loanwords")+
    theme_bw()+
    theme(legend.position = "none")
```
## Including Plots

5. Medians of Qax Azeri influence:
```{r, echo = FALSE}
qax_azeri_counts <- aggregate(qax_azeri$Present, by=list(qax_azeri$Speaker), FUN=sum, na.rm=TRUE, na.action=NULL)
colnames(qax_azeri_counts) <- c("Speaker","Turkic_Loans")
qax_azeri_counts <- left_join(regions, qax_azeri_counts, by= c("Speaker"))
qax_azeri_counts$Region <- as.factor(qax_azeri_counts$Region)
qax_azeri_counts <- qax_azeri_counts[-c(1:6),]
toBeRemoved<-which(qax_azeri_counts$Region %in% c("Tabasaran_Azeri", "Qax_Azeri"))
qax_azeri_counts<-qax_azeri_counts[-toBeRemoved,]
qax_azeri_counts$Region <- factor(qax_azeri_counts$Region, levels=c("Tabasaran", "Khiv", "Rutul", "Tsakhur"))

p4 <- ggplot(data = qax_azeri_counts, aes(x = Region, y = Turkic_Loans)) + 
    geom_jitter(aes(color = factor(village)), position = position_jitter(width = 0.1, height = 0.1)) +
    # levels = c("Dyubek","Tatil","Khapil","Yagdyg","Khiv","Laka","Khoredzh","Kiche","Rutul","Kina","Ikhrek", "Helmets", "Mikik")
    stat_summary(fun.y = "median", geom = "point", pch = "_", size = 15)+
    labs(title = "Qax Azerbaijani Influence", x = "Region", y = "Number of Loanwords")+
    theme_bw()+
    theme(legend.position = "none")
```

6. Medians of Dialect Azeri influence:
```{r, echo = FALSE}
dialect_azeri_counts <- aggregate(dialect_azeri$Present, by=list(dialect_azeri$Speaker), FUN=sum, na.rm=TRUE, na.action=NULL)
colnames(dialect_azeri_counts) <- c("Speaker","Turkic_Loans")
dialect_azeri_counts <- left_join(regions, dialect_azeri_counts, by= c("Speaker"))
dialect_azeri_counts$Region <- as.factor(dialect_azeri_counts$Region)
dialect_azeri_counts <- dialect_azeri_counts[-c(1:6),]
toBeRemoved<-which(dialect_azeri_counts$Region %in% c("Tabasaran_Azeri", "Qax_Azeri"))
dialect_azeri_counts<-dialect_azeri_counts[-toBeRemoved,]
dialect_azeri_counts$Region <- factor(dialect_azeri_counts$Region, levels=c("Tabasaran", "Khiv", "Rutul", "Tsakhur"))

p5 <- ggplot(data = dialect_azeri_counts, aes(x = Region, y = Turkic_Loans)) + 
    geom_jitter(aes(color = factor(village)), position = position_jitter(width = 0.1, height = 0.1)) +
    # levels = c("Dyubek","Tatil","Khapil","Yagdyg","Khiv","Laka","Khoredzh","Kiche","Rutul","Kina","Ikhrek", "Helmets", "Mikik")
    stat_summary(fun.y = "median", geom = "point", pch = "_", size = 15)+
    labs(title = "Dialect Azerbaijani Influence", x = "Region", y = "Number of Loanwords")+
    theme_bw()+
    theme(legend.position = "none")
```

Extracting legend:
```{r echo=FALSE}
p5_leg <- ggplot(data = dialect_azeri_counts, aes(x = Region, y = Turkic_Loans)) + 
    geom_jitter(aes(color = factor(village)), position = position_jitter(width = 0.1, height = 0.1)) +
    # levels = c("Dyubek","Tatil","Khapil","Yagdyg","Khiv","Laka","Khoredzh","Kiche","Rutul","Kina","Ikhrek", "Helmets", "Mikik")
    stat_summary(fun.y = "median", geom = "point", pch = "_", size = 15)+
    labs(title = "Dialect Azerbaijani Influence", x = "Region", y = "Number of Loanwords")+
    theme_bw()+
    theme(legend.position = "bottom", legend.title = element_blank())+
    guides(fill=guide_legend(ncol=2,byrow=TRUE))

g_legend <- function(a.gplot){ 
  tmp <- ggplot_gtable(ggplot_build(a.gplot)) 
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box") 
  legend <- tmp$grobs[[leg]] 
  return(legend)} 
p6 <- g_legend(p5_leg)
```

```{r}
library(gridExtra)
grid.arrange(p1, p2, p3, p4, p5, p6)
```

Plotting Turkic:
```{r echo=FALSE}
nodict_azeri_counts <- aggregate(nodict_azeri$Present, by=list(nodict_azeri$Speaker), FUN=sum, na.rm=TRUE, na.action=NULL)
colnames(nodict_azeri_counts) <- c("Speaker","No_A_Loans")
nodict_azeri_counts <- left_join(regions, nodict_azeri_counts, by= c("Speaker"))
nodict_azeri_counts$Region <- as.factor(nodict_azeri_counts$Region)
nodict_azeri_counts$village <- as.factor(nodict_azeri_counts$village)
nodict_azeri_counts <- nodict_azeri_counts[-c(1:6),]
toBeRemoved<-which(nodict_azeri_counts$Region %in% c("Tabasaran", "Khiv", "Rutul", "Tsakhur"))
nodict_azeri_counts<-nodict_azeri_counts[-toBeRemoved,]
nodict_azeri_counts$Region <- droplevels(nodict_azeri_counts$Region)
nodict_azeri_counts$Region <- factor(nodict_azeri_counts$Region, levels=c("Tabasaran_Azeri", "Qax_Azeri"))

nodictkum_azeri_counts <- aggregate(nodictkum_azeri$Present, by=list(nodictkum_azeri$Speaker), FUN=sum, na.rm=TRUE, na.action=NULL)
colnames(nodictkum_azeri_counts) <- c("Speaker","No_AK_Loans")
nodictkum_azeri_counts <- left_join(regions, nodictkum_azeri_counts, by= c("Speaker"))
nodictkum_azeri_counts$Region <- as.factor(nodictkum_azeri_counts$Region)
nodictkum_azeri_counts$village <- as.factor(nodictkum_azeri_counts$village)
nodictkum_azeri_counts <- nodictkum_azeri_counts[-c(1:6),]
toBeRemoved<-which(nodictkum_azeri_counts$Region %in% c("Tabasaran", "Khiv", "Rutul", "Tsakhur"))
nodictkum_azeri_counts<-nodictkum_azeri_counts[-toBeRemoved,]
nodictkum_azeri_counts$Region <- droplevels(nodictkum_azeri_counts$Region)
nodictkum_azeri_counts$Region <- factor(nodictkum_azeri_counts$Region, levels=c("Tabasaran_Azeri", "Qax_Azeri"))

nodict_turkic_counts <- left_join(nodictkum_azeri_counts[,c(2,4)], nodict_azeri_counts, by= c("Speaker"))
```

Plotting Kumykization:
```{r echo = FALSE}
ggplot(data = nodict_turkic_counts, aes(x = No_AK_Loans, y = No_A_Loans)) + 
    geom_point(aes(color = factor(village)), position = position_jitter(width = 0.1, height = 0.1)) +
  geom_smooth(method="lm", aes(fill=Region, color = Region))+
    # levels = c("Dyubek","Tatil","Khapil","Yagdyg","Khiv","Laka","Khoredzh","Kiche","Rutul","Kina","Ikhrek", "Helmets", "Mikik")
    labs(title = "Kumykization of Azerbaijani Dialects", x = "Non-standard and non-Kumyk", y = "Non-standard")+
    xlim(0, 50)+
    ylim(0,50)+
    theme_bw()+
    theme(legend.position = "bottom", legend.title = element_blank())+
    guides(fill=guide_legend(ncol=2,byrow=TRUE))

```


```{r echo=FALSE}
db <- turkic <- read.csv("words_s.csv", header = TRUE, sep = ";", na.strings = "NA", row.names = NULL)
head(db)
db$simset <- paste(db$Concept, db$Concept.nr.)
db$simset <- str_replace_all(db$simset," ","_")
qax_to_stay <- qax_azeri[which(qax_azeri$Present == 1),]
qax_to_stay$Lexeme <- as.character(qax_to_stay$Lexeme)
qax_words <- db[,which(db$simset %in% qax_to_stay$Lexeme)]
qax_words

tabasaran_to_stay <- tabasaran_azeri[which(tabasaran_azeri$Present == 1),]
tabasaran_to_stay$Lexeme <- as.character(tabasaran_to_stay$Lexeme)
tabasaran_words <- db[db$simset %in% tabasaran_to_stay$Lexeme,]
tabasaran_words

```
